<?php

/**
 * @file
 * Shared Components module - Componentes globales para multisite.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function shared_components_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    case 'help.page.shared_components':
      return '<p>' . t('MÃ³dulo para componentes compartidos entre sitios.') . '</p>';
  }
}

/**
 * Implements hook_library_info_build().
 */
function shared_components_library_info_build() {
  $libraries = [];
  $module_handler = \Drupal::service('module_handler');
  $module_path = $module_handler->getModule('shared_components')->getPath();
  $component_path = $module_path . '/components';

  if (!is_dir(DRUPAL_ROOT . '/' . $component_path)) {
    return $libraries;
  }

  $components = scandir(DRUPAL_ROOT . '/' . $component_path);

  foreach ($components as $component) {
    if ($component == '.' || $component == '..') {
      continue;
    }

    $full_component_path = DRUPAL_ROOT . '/' . $component_path . '/' . $component;

    if (!is_dir($full_component_path)) {
      continue;
    }

    $library = [];

    $css_file = $component_path . '/' . $component . '/' . $component . '.css';
    if (file_exists(DRUPAL_ROOT . '/' . $css_file)) {
      $library['css']['theme'][$css_file] = [];
    }

    $js_file = $component_path . '/' . $component . '/' . $component . '.js';
    if (file_exists(DRUPAL_ROOT . '/' . $js_file)) {
      $library['js'][$js_file] = [];
    }

    if (!empty($library)) {
      $libraries[$component] = $library;
    }
  }

  return $libraries;
}
